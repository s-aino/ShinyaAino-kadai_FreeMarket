erDiagram
  USERS ||--|| PROFILES : "1:1 (user_id UNIQUE)"
  USERS ||--o{ ADDRESSES : hasMany
  USERS ||--o{ ITEMS : hasMany
  USERS ||--o{ COMMENTS : hasMany
  USERS }o--o{ ITEMS : "favorites"

  ITEMS ||--o{ ITEM_IMAGES : hasMany
  ITEMS ||--o{ COMMENTS : hasMany
  CATEGORIES ||--o{ ITEMS : hasMany
  CATEGORIES ||--o{ CATEGORIES : "children (parent_id)"

  ORDERS }o--|| USERS : "buyer_id"
  ORDERS }o--|| ADDRESSES : "ship to"
  ORDERS ||--o{ ORDER_ITEMS : hasMany
  ORDER_ITEMS }o--|| ITEMS : belongsTo

  USERS {
    bigint   id PK
    string   name
    string   email        "UNIQUE"
    string   password
    string   avatar_path  "nullable"
    timestamp email_verified_at "nullable"
  }

  PROFILES {
    bigint id PK
    bigint user_id FK  "UNIQUE(1:1)"
    string display_name "nullable"
    string bio          "nullable"
    string website_url  "nullable"
    date   birthdate    "nullable"
  }

  CATEGORIES {
    bigint id PK
    string name
    string slug "UNIQUE"
    bigint parent_id FK "nullable"
  }

  ITEMS {
    bigint id PK
    bigint user_id FK
    bigint category_id FK
    string title
    text   description
    int    price
    string status        "active|sold|paused"
    tinyint condition    "nullable"
    timestamp published_at "nullable"
  }

  ITEM_IMAGES {
    bigint id PK
    bigint item_id FK
    string path
    smallint sort_order
  }

  FAVORITES {
    bigint user_id FK
    bigint item_id FK
  }

  ORDERS {
    bigint id PK
    bigint buyer_id FK
    bigint address_id FK
    int    total_amount
    string status        "pending|paid|canceled|refunded"
    timestamp ordered_at
  }

  ORDER_ITEMS {
    bigint id PK
    bigint order_id FK
    bigint item_id FK
    int    price
    int    qty
  }

  ADDRESSES {
    bigint id PK
    bigint user_id FK
    string postal
    string prefecture
    string city
    string line1
    string line2  "nullable"
    string phone  "nullable"
    boolean is_default
  }

  COMMENTS {
    bigint id PK
    bigint user_id FK
    bigint item_id FK
    string body
  }
